<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KTL Configuration Generator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        .container {
            margin-top: 20px;
        }

        h2 {
            margin-bottom: 20px;
        }

        /* Style adjustments for inline label-input pairs */
        .form-inline {
            display: flex;
            align-items: center;
            margin-bottom: 10px; /* Spacing between each form group */
        }

            .form-inline label {
                margin-right: 10px; /* Spacing between label and input */
            }

        /* Adjustments for checkbox groups to align items */
        .checkbox-group {
            display: flex;
            flex-direction: column;
        }

        .checkbox-inline {
            display: flex;
            align-items: center; /* Align checkbox and its label */
            margin-bottom: 5px; /* Spacing between each checkbox */
        }

            .checkbox-inline label {
                margin-right: 5px;
                margin-bottom: 0; /* Override Bootstrap's default bottom margin for labels */
            }
    </style>
</head>
<body>
    <div class="container">
        <h2>KTL Configuration Utility</h2>
        <button type="button" id="saveToFileBtn" class="btn btn-primary">Save to File</button>
        <button type="button" id="loadFromFileBtn" class="btn btn-primary">Load from File</button>
        <input type="file" id="fileInput" accept=".ktlcfg" style="display:none;">

        <form id="ktlConfigForm">
            <!-- Group: Core Settings -->
            <fieldset class="form-group border p-3">
                <legend>Core Settings</legend>
                <div>
                    <label>Developer Names (comma-separated):</label>
                    <input type="text" class="form-control" id="developerNames" placeholder="Firstname Lastname">
                </div>
                <div>
                    <label>Developer Email:</label>
                    <input type="email" class="form-control" id="developerEmail" placeholder="yourmail@provider.com">
                </div>
                <div>
                    <label>Developer Options PIN:</label>
                    <input type="text" class="form-control" id="devOptionsPin" placeholder="0000">
                </div>
            </fieldset>

            <!-- Group: Main KTL Feature Switches -->
            <fieldset class="form-group border p-3">
                <legend>General Feature Settings</legend>

                <!-- Sub-Group: Feature Switches -->
                <fieldset class="form-group border p-3">
                    <legend>Version Info Bar Settings</legend>
                    <div class="checkbox-inline">
                        <label for="viShowAppInfo">Show App Info</label>
                        <input type="checkbox" id="viShowAppInfo" checked><br>
                    </div>
                    <div class="checkbox-inline">
                        <label for="viShowKtlInfo">Show KTL Info</label>
                        <input type="checkbox" id="viShowKtlInfo" checked><br>
                    </div>
                    <div class="form-inline">
                        <label for="viShowToRoles">Show to these roles only</label>
                        <input type="text" class="form-control" id="viShowToRoles" placeholder="Developer" value="Developer">
                    </div>
                    <div class="form-inline">
                        <label for="viPosX">Default Horizontal Pos</label>
                        <select class="form-control" id="viPosX">
                            <option value="right">Right</option>
                            <option value="center">Center</option>
                            <option value="left">Left</option>
                        </select>
                    </div>
                    <div class="form-inline">
                        <label for="viPosY">Default Vertical Position</label>
                        <select class="form-control" id="viPosY">
                            <option value="top">Top</option>
                            <option value="bottom">Bottom</option>
                        </select>
                    </div>
                    <div class="form-inline">
                        <label for="viPosXMobile">Mobile Horizontal Pos</label>
                        <select class="form-control" id="viPosXMobile">
                            <option value="center">Center</option>
                            <option value="left">Left</option>
                            <option value="right">Right</option>
                        </select>
                    </div>
                    <div class="form-inline">
                        <label for="viPosYMobile">Mobile Vertical Position</label>
                        <select class="form-control" id="viPosYMobile">
                            <option value="bottom">Bottom</option>
                            <option value="top">Top</option>
                        </select>
                    </div>

                    <div class="form-inline">
                        <label for="viOpacity">Default Opacity</label>
                        <input type="number" class="form-control" id="viOpacity" placeholder="50" value="50">
                    </div>
                    <div class="form-inline">
                        <label for="viOpacityHover">Opacity on Hover</label>
                        <input type="number" class="form-control" id="viOpacityHover" placeholder="100" value="100">
                    </div>
                </fieldset>

                <!-- Sub-Group: Feature Switches -->
                <fieldset class="form-group border p-3">
                    <legend>Feature Switches</legend>
                    <div class="checkbox-inline">
                        <label for="showMenuInTitle">Show Menu in Title</label>
                        <input type="checkbox" id="showMenuInTitle" checked><br>
                    </div>
                    <div class="checkbox-inline">
                        <label for="selTextOnFocus">Select Text on Focus</label>
                        <input type="checkbox" id="selTextOnFocus" checked><br>
                    </div>
                        <!-- Additional feature switches here -->
                    </div>
                </fieldset>

                <!-- Sub-Group: Popup Style Settings -->
                <fieldset class="form-group border p-3">
                    <legend>Popup Style Settings</legend>
                    <!-- Inputs for popupStyle settings -->
                </fieldset>

                <!-- Sub-Group: Tooltip Styles Settings -->
                <fieldset class="form-group border p-3">
                    <legend>Tooltip Styles Settings</legend>
                    <!-- Inputs for tooltipStyles settings -->
                </fieldset>
            </fieldset>

            <!-- Group: Scenes Settings -->
            <fieldset class="form-group border p-3">
                <legend>Scenes Settings</legend>
                <!-- Inputs for scenes settings -->
            </fieldset>

            <!-- Group: Views Settings -->
            <fieldset class="form-group border p-3">
                <legend>Views Settings</legend>
                <!-- Inputs for views settings -->
            </fieldset>

            <!-- Group: Fields Settings -->
            <fieldset class="form-group border p-3">
                <legend>Fields Settings</legend>
                <!-- Inputs for fields settings -->
            </fieldset>

            <!-- Group: Persistent Forms Settings -->
            <fieldset class="form-group border p-3">
                <legend>Persistent Forms Settings</legend>
                <!-- Inputs for persistent forms settings -->
            </fieldset>

            <!-- Group: System Colors Settings -->
            <fieldset class="form-group border p-3">
                <legend>System Colors Settings</legend>
                <!-- Inputs for system colors settings -->
            </fieldset>

            <!-- Group: Advanced Settings -->
            <fieldset class="form-group border p-3">
                <legend>Advanced Settings</legend>
                <!-- Sub-Group: Kiosk Settings -->
                <!-- Sub-Group: Logging Settings -->
                <!-- Sub-Group: iFrameWnd Settings -->
            </fieldset>

            <button type="button" class="btn btn-primary" id="generateConfigBtn">Generate Configuration</button>
        </form>

        <textarea id="generatedConfig" rows="100" class="form-control" style="margin-top: 20px;"></textarea>
    </div>

    <script>
        document.getElementById('generateConfigBtn').addEventListener('click', function () {
            const developerNamesInput = document.getElementById('developerNames').value;
            const developerNames = developerNamesInput.split(',').map(name => name.trim()).map(name => `'${name}'`);
            const developerEmail = document.getElementById('developerEmail').value;
            const devOptionsPin = document.getElementById('devOptionsPin').value;

            // Collecting values for the enabled section
            const enabled = {
                versionInfo: {
                    viShowAppInfo: document.getElementById('viShowAppInfo').checked,
                    viShowKtlInfo: document.getElementById('viShowKtlInfo').checked,
                    viShowToRoles: ['Developer'],
                    viPosX: 'right',
                    viPosY: 'top',
                    viPosXMobile: 'center',
                    viPosYMobile: 'bottom',
                    viOpacity: 50,
                    viOpacityHover: 100
                },

                showMenuInTitle: document.getElementById('showMenuInTitle').checked,
                selTextOnFocus: document.getElementById('selTextOnFocus').checked,

                // Continue collecting other flat feature switches
                bulkOps: {
                    bulkEdit: true, // Assuming static for this example
                    bulkCopy: true,
                    bulkDelete: true,
                },
                // Add the rest as per the checkboxes and inputs you've defined
            };

            // Generating the configuration script
            let configScript = `
window.APP_VERSION = '1.0.0';

window.ktlReady = function (appInfo = {}) {
                            var ktl = new Ktl($, appInfo);

                            ktl.core.setCfg({
                                developerNames: [${developerNames.join(', ')}],
                                developerEmail: '${developerEmail}',
                                devOptionsPin: '${devOptionsPin}',
                                enabled: {
                                    versionInfo: {
                                        viShowAppInfo: ${enabled.versionInfo.viShowAppInfo},
                                        viShowKtlInfo: ${enabled.versionInfo.viShowKtlInfo},
                                        viShowToRoles: ['Developer'],
                                        viPosX: '${enabled.versionInfo.viPosX}',
                                        viPosY: '${enabled.versionInfo.viPosY}',
                                        viPosXMobile: '${enabled.versionInfo.viPosXMobile}',
                                        viPosYMobile: '${enabled.versionInfo.viPosYMobile}',
                                        viOpacity: ${enabled.versionInfo.viOpacity},
                                        viOpacityHover: ${enabled.versionInfo.viOpacityHover}
                                    },
                                    showMenuInTitle: ${enabled.showMenuInTitle},
                                    selTextOnFocus: ${enabled.selTextOnFocus},
                                    // Include the rest of the enabled configurations...
                                }
                            });

                            // KTL Setup - END
                            // Additional JavaScript based on user inputs goes here...
};
                            `;

            // Display the generated configuration script
            document.getElementById('generatedConfig').value = configScript;
        });

        document.getElementById('saveToFileBtn').addEventListener('click', function () {
            // Prompt the user for a filename, providing a default
            let filename = prompt("Enter a filename for your configuration:", "MySetup.ktlcfg");
            if (filename) {
                if (!filename.endsWith('.ktlcfg')) {
                    filename += '.ktlcfg'; // Ensure the file has the correct extension
                }

                // Collect all form inputs here
                const formInputs = {
                    developerNames: document.getElementById('developerNames').value.split(',').map(name => name.trim()),
                    developerEmail: document.getElementById('developerEmail').value,
                    devOptionsPin: document.getElementById('devOptionsPin').value,
                    // Version Info
                    versionInfo: {
                        viShowAppInfo: document.getElementById('viShowAppInfo').checked,
                        viShowKtlInfo: document.getElementById('viShowKtlInfo').checked,
                        viShowToRoles: document.getElementById('viShowToRoles').value.split(',').map(role => role.trim()),
                        viPosX: document.getElementById('viPosX').value,
                        viPosY: document.getElementById('viPosY').value,
                        viPosXMobile: document.getElementById('viPosXMobile').value,
                        viPosYMobile: document.getElementById('viPosYMobile').value,
                        viOpacity: parseInt(document.getElementById('viOpacity').value, 10),
                        viOpacityHover: parseInt(document.getElementById('viOpacityHover').value, 10),
                    },
                    // Include additional configurations as needed...
                };

                // Convert form data to a JSON string
                const dataStr = JSON.stringify(formInputs, null, 4);
                const blob = new Blob([dataStr], { type: "application/json" });

                // Create a link and trigger download
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            } else {
                alert("File save cancelled.");
            }
        });

        document.getElementById('loadFromFileBtn').addEventListener('click', function () {
            // Programmatically click the hidden file input
            document.getElementById('fileInput').click();
        });

        document.getElementById('fileInput').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                // Create a FileReader to read the selected file
                const reader = new FileReader();
                reader.onload = function (fileLoadEvent) {
                    const contents = fileLoadEvent.target.result;

                    // Try parsing the JSON contents and populating the form
                    try {
                        const config = JSON.parse(contents);
                        if (config) {
                            // Populate the form with loaded configuration
                            document.getElementById('developerNames').value = config.developerNames.join(', ');
                            document.getElementById('developerEmail').value = config.developerEmail;
                            document.getElementById('devOptionsPin').value = config.devOptionsPin;
                            // Version Info
                            document.getElementById('viShowAppInfo').checked = config.versionInfo.viShowAppInfo;
                            document.getElementById('viShowKtlInfo').checked = config.versionInfo.viShowKtlInfo;
                            document.getElementById('viShowToRoles').value = config.versionInfo.viShowToRoles.join(', ');
                            document.getElementById('viPosX').value = config.versionInfo.viPosX;
                            document.getElementById('viPosY').value = config.versionInfo.viPosY;
                            document.getElementById('viPosXMobile').value = config.versionInfo.viPosXMobile;
                            document.getElementById('viPosYMobile').value = config.versionInfo.viPosYMobile;
                            document.getElementById('viOpacity').value = config.versionInfo.viOpacity;
                            document.getElementById('viOpacityHover').value = config.versionInfo.viOpacityHover;
                            // Handle additional configurations as necessary...

                            // Feature Switches
                            document.getElementById('showMenuInTitle').checked = config.showMenuInTitle ?? false;
                            document.getElementById('selTextOnFocus').checked = config.selTextOnFocus ?? false;



                            // Handle developerNames differently based on its type
                            if (Array.isArray(config.developerNames)) {
                                document.getElementById('developerNames').value = config.developerNames.join(', ');
                            } else {
                                alert('Error - developerNames not an array.');
                            }

                            // Populate other form fields
                            document.getElementById('developerEmail').value = config.developerEmail || '';
                            document.getElementById('devOptionsPin').value = config.devOptionsPin || '';
                            // Repeat for other fields as necessary
                        }
                    } catch (error) {
                        alert('Error reading file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        });

    </script>


    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>
