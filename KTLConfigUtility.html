<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KTL Configuration Generator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        .container {
            margin-top: 20px;
        }

        h2 {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>KTL Configuration Form</h2>
        <button type="button" id="saveToFileBtn" class="btn btn-primary">Save to File</button>
        <button type="button" id="loadFromFileBtn" class="btn btn-primary">Load from File</button>
        <input type="file" id="fileInput" accept=".ktlcfg" style="display:none;">

        <form id="ktlConfigForm">
            <!-- Group: Core Settings -->
            <fieldset class="form-group border p-3">
                <legend>Core Settings</legend>
                <div>
                    <label>Developer Names (comma-separated):</label>
                    <input type="text" class="form-control" id="developerNames" placeholder="Firstname Lastname">
                </div>
                <div>
                    <label>Developer Email:</label>
                    <input type="email" class="form-control" id="developerEmail" placeholder="yourmail@provider.com">
                </div>
                <div>
                    <label>Developer Options PIN:</label>
                    <input type="text" class="form-control" id="devOptionsPin" placeholder="0000">
                </div>
            </fieldset>

            <!-- Group: Main KTL Feature Switches -->
            <fieldset class="form-group border p-3">
                <legend>Main KTL Feature Switches</legend>

                <!-- Sub-Group: Version Info Settings -->
                <fieldset class="form-group border p-3">
                    <legend>Version Info Settings</legend>
                    <div class="checkbox-group">
                        <input type="checkbox" id="viShowAppInfo" checked> Show App Info<br>
                        <input type="checkbox" id="viShowKtlInfo" checked> Show KTL Info<br>
                        <!-- Additional versionInfo settings here -->
                    </div>
                </fieldset>

                <!-- Sub-Group: Feature Switches -->
                <fieldset class="form-group border p-3">
                    <legend>Feature Switches</legend>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showMenuInTitle" checked> Show Menu in Title<br>
                        <input type="checkbox" id="selTextOnFocus" checked> Select Text on Focus<br>
                        <!-- Additional feature switches here -->
                    </div>
                </fieldset>

                <!-- Sub-Group: Popup Style Settings -->
                <fieldset class="form-group border p-3">
                    <legend>Popup Style Settings</legend>
                    <!-- Inputs for popupStyle settings -->
                </fieldset>

                <!-- Sub-Group: Tooltip Styles Settings -->
                <fieldset class="form-group border p-3">
                    <legend>Tooltip Styles Settings</legend>
                    <!-- Inputs for tooltipStyles settings -->
                </fieldset>
            </fieldset>

            <!-- Group: Scenes Settings -->
            <fieldset class="form-group border p-3">
                <legend>Scenes Settings</legend>
                <!-- Inputs for scenes settings -->
            </fieldset>

            <!-- Group: Views Settings -->
            <fieldset class="form-group border p-3">
                <legend>Views Settings</legend>
                <!-- Inputs for views settings -->
            </fieldset>

            <!-- Group: Fields Settings -->
            <fieldset class="form-group border p-3">
                <legend>Fields Settings</legend>
                <!-- Inputs for fields settings -->
            </fieldset>

            <!-- Group: Persistent Forms Settings -->
            <fieldset class="form-group border p-3">
                <legend>Persistent Forms Settings</legend>
                <!-- Inputs for persistent forms settings -->
            </fieldset>

            <!-- Group: System Colors Settings -->
            <fieldset class="form-group border p-3">
                <legend>System Colors Settings</legend>
                <!-- Inputs for system colors settings -->
            </fieldset>

            <!-- Group: Advanced Settings -->
            <fieldset class="form-group border p-3">
                <legend>Advanced Settings</legend>
                <!-- Sub-Group: Kiosk Settings -->
                <!-- Sub-Group: Logging Settings -->
                <!-- Sub-Group: iFrameWnd Settings -->
            </fieldset>

            <button type="button" class="btn btn-primary" id="generateConfigBtn">Generate Configuration</button>
        </form>

        <textarea id="generatedConfig" rows="10" class="form-control" style="margin-top: 20px;"></textarea>
    </div>

    <script>
        document.getElementById('generateConfigBtn').addEventListener('click', function () {
            const developerNamesInput = document.getElementById('developerNames').value;
            const developerNames = developerNamesInput.split(',').map(name => name.trim()).map(name => `'${name}'`);
            const developerEmail = document.getElementById('developerEmail').value;
            const devOptionsPin = document.getElementById('devOptionsPin').value;

            // Collecting values for the enabled section
            const enabled = {
                versionInfo: {
                    viShowAppInfo: document.getElementById('viShowAppInfo').checked,
                    viShowKtlInfo: document.getElementById('viShowKtlInfo').checked,
                    viShowToRoles: ['Developer'], // Example, modify as needed
                    viPosX: 'right', // Example, make dynamic as needed
                    viPosY: 'top', // Example, make dynamic as needed
                    viPosXMobile: 'center', // Example, make dynamic as needed
                    viPosYMobile: 'bottom', // Example, make dynamic as needed
                    viOpacity: 50, // Example, make dynamic as needed
                    viOpacityHover: 100 // Example, make dynamic as needed
                },
                showMenuInTitle: document.getElementById('showMenuInTitle').checked,
                selTextOnFocus: document.getElementById('selTextOnFocus').checked,
                // Continue collecting other flat feature switches
                bulkOps: {
                    bulkEdit: true, // Assuming static for this example
                    bulkCopy: true,
                    bulkDelete: true,
                },
                // Add the rest as per the checkboxes and inputs you've defined
            };

            // Generating the configuration script
            let configScript = `
window.APP_VERSION = '1.0.0';

window.ktlReady = function (appInfo = {}) {
                    var ktl = new Ktl($, appInfo);

                    ktl.core.setCfg({
                        developerNames: [${developerNames.join(', ')}],
                        developerEmail: '${developerEmail}',
                        devOptionsPin: '${devOptionsPin}',
                        enabled: {
                            versionInfo: {
                                viShowAppInfo: ${enabled.versionInfo.viShowAppInfo},
                                viShowKtlInfo: ${enabled.versionInfo.viShowKtlInfo},
                                viShowToRoles: ['Developer'],
                                viPosX: '${enabled.versionInfo.viPosX}',
                                viPosY: '${enabled.versionInfo.viPosY}',
                                viPosXMobile: '${enabled.versionInfo.viPosXMobile}',
                                viPosYMobile: '${enabled.versionInfo.viPosYMobile}',
                                viOpacity: ${enabled.versionInfo.viOpacity},
                                viOpacityHover: ${enabled.versionInfo.viOpacityHover}
                            },
                            showMenuInTitle: ${enabled.showMenuInTitle},
                            selTextOnFocus: ${enabled.selTextOnFocus},
                            // Include the rest of the enabled configurations...
                        }
                    });

                    // KTL Setup - END
                    // Additional JavaScript based on user inputs goes here...
};
                    `;

            // Display the generated configuration script
            document.getElementById('generatedConfig').value = configScript;
        });

        document.getElementById('saveToFileBtn').addEventListener('click', function () {
            // Prompt the user for a filename, providing a default
            let filename = prompt("Enter a filename for your configuration:", "MySetup.ktlcfg");
            if (filename) {
                if (!filename.endsWith('.ktlcfg')) {
                    filename += '.ktlcfg'; // Ensure the file has the correct extension
                }

                const formInputs = {
                    developerNames: document.getElementById('developerNames').value.split(',').map(name => name.trim()),
                    developerEmail: document.getElementById('developerEmail').value,
                    devOptionsPin: document.getElementById('devOptionsPin').value,
                    // Add all other form fields here...
                };

                // Convert form data to a JSON string
                const dataStr = JSON.stringify(formInputs, null, 4);
                const blob = new Blob([dataStr], { type: "application/json" });

                // Create a link and trigger download
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            } else {
                alert("File save cancelled.");
            }
        });

        document.getElementById('loadFromFileBtn').addEventListener('click', function () {
            // Programmatically click the hidden file input
            document.getElementById('fileInput').click();
        });

        document.getElementById('fileInput').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                // Create a FileReader to read the selected file
                const reader = new FileReader();
                reader.onload = function (fileLoadEvent) {
                    const contents = fileLoadEvent.target.result;

                    // Try parsing the JSON contents and populating the form
                    try {
                        const config = JSON.parse(contents);
                        if (config) {
                            // Handle developerNames differently based on its type
                            if (Array.isArray(config.developerNames)) {
                                // If developerNames is an array, join it into a string
                                document.getElementById('developerNames').value = config.developerNames.join(', ');
                            } else if (typeof config.developerNames === 'string') {
                                // If developerNames is a string, use it directly
                                document.getElementById('developerNames').value = config.developerNames;
                            } else {
                                // Handle other cases or set a default value
                                document.getElementById('developerNames').value = '';
                            }

                            // Populate other form fields
                            document.getElementById('developerEmail').value = config.developerEmail || '';
                            document.getElementById('devOptionsPin').value = config.devOptionsPin || '';
                            // Repeat for other fields as necessary
                        }
                    } catch (error) {
                        alert('Error reading file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        });

    </script>


    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>
