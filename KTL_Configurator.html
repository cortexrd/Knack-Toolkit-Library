<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KTL Configurator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
    <link rel="icon" type="image/png" href="https://ctrnd.s3.amazonaws.com/media/KTL-small-icon.png">
    <style>
        @font-face {
            font-family: 'Harabara';
            src: url('https://ctrnd.s3.amazonaws.com/fonts/Harabara.ttf') format('truetype');
        }

        @font-face {
            font-family: 'Audiowide';
            src: url('https://ctrnd.s3.amazonaws.com/fonts/Audiowide-Regular.ttf') format('truetype');
        }

        .container {
            margin-top: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
        }

        #appTitle {
            font-family: 'Audiowide', sans-serif;
        }

        #appVersion {
            font-family: sans-serif;
            font-size: 0.8em;
            color: #666;
        }

        .title-container h1 {
            margin: 0;
            font-family: 'Audiowide', sans-serif;
        }

        .title-container #appVersion {
            font-size: 0.5em;
            color: #666;
        }

        .title-container #companyName, #slogan {
            font-family: 'Harabara', sans-serif;
            font-size: 1.4rem;
        }

        .title-container #companyName {
            font-family: 'Harabara', sans-serif;
        }

        #slogan, #companyName {
            font-size: 1.4rem;
        }

        .company-logo-container img, .ktl-logo-container img {
            max-height: 80px;
            padding: 0 15px;
        }

        .ktl-logo-container {
            text-align: center;
        }

        .ktl-logo-container img {
            max-height: 120px;
        }

        .ktl-logo-container #slogan {
            font-family: 'Harabara', sans-serif;
            font-size: 1.4rem;
            text-align: center;
            display: block;
        }

        #documentationIframe {
            visibility: collapse;
        }

        .iframe-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10; /* Adjust if necessary to ensure it covers the iframe */
            background: transparent; /* Keeps the overlay invisible */
        }

        h2 {
            margin-bottom: 20px;
            font-size: 1.6rem;
        }

        .form-group {
            margin-top: 1rem;
        }

        .form-inline {
            display: block;
            align-items: center;
            margin-bottom: 10px;
        }

            .form-inline label {
                margin-right: 10px;
                justify-content: left;
            }

            .form-inline .form-control {
                display: inline-block;
                width: 100%;
                vertical-align: middle;
            }

        .checkbox-group {
            display: flex;
            flex-direction: column;
        }

        .checkbox-inline {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

            .checkbox-inline label {
                margin-right: 5px;
                margin-bottom: 0;
            }

        label {
            margin-bottom: .1rem;
        }

        .fieldset-color-1 {
            background-color: #E1EFEF;
        }

        .fieldset-color-2 {
            background-color: #D1DFDF;
        }

        .fieldset-color-3 {
            background-color: #C1CFCF;
        }

        .fieldset-color-4 {
            background-color: #B1BFBF;
        }

        .fieldset-color-5 {
            background-color: #A1AFAF;
        }

        .fieldset-color-6 {
            background-color: #919F9F;
        }

        .border {
            border: none !important;
        }

        fieldset legend {
            position: relative;
            top: 20px;
            background: unset;
            padding: 0 5px;
            width: auto;
            font-size: 1.2rem;
            font-weight: 600;
        }

        #grabber {
            width: 25px;
            height: 100%;
            background-color: #ccc;
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
            position: absolute;
            left: 0px;
            top: 50%;
            transform: translateY(-50%);
            cursor: grab;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 4px;
        }

        .dot-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin: 2px 0;
        }

        .dot {
            width: 6px;
            height: 6px;
            background-color: #666;
            border-radius: 50%;
        }

        input[type=checkbox] {
            width: 18px;
            height: 18px;
        }

        .legend-help-icon {
            cursor: pointer;
        }

        .fa, .fas {
            font-weight: 900;
            font-size: 1.2rem;
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title-container">
                <h1 id="appTitle">KTL Configurator <span id="appVersion">v1.0.0</span></h1>
                <h2><span style="color: gray;font-size: 0.8em;font-weight: 400;">by</span> <span id="companyName">Cortex R&amp;D Inc.</span></h2>
            </div>
            <div class="company-logo-container">
                <a href="https://ctrnd.com" target="_blank">
                    <img src="https://ctrnd.s3.amazonaws.com/media/Cortex-logo+RGB+horizontal.png" alt="Cortex Logo" id="companyLogo">
                </a>
            </div>
            <div class="ktl-logo-container">
                <a href="https://github.com/cortexrd/Knack-Toolkit-Library" target="_blank">
                    <img src="https://ctrnd.s3.amazonaws.com/media/KTL.png" alt="KTL Logo" id="appLogo">
                </a>
                <span id="slogan">Where Simplicity meets Magic!</span>
            </div>
        </div>

        <div class="form-group">
            <label for="appNameInput">App Name:</label>
            <input type="text" id="appNameInput" class="form-control" placeholder="Enter your app name">
        </div>

        <button type="button" id="saveBtn" class="btn btn-primary">Save</button>
        <button type="button" id="loadBtn" class="btn btn-secondary">Load</button>
        <button type="button" id="exportToFileBtn" class="btn btn-info">Export to File</button>
        <button type="button" id="importFromFileBtn" class="btn btn-info">Import from File</button>

        <span id="buttonsHelpIcon" class="legend-help-icon" data-section-id="getting-started-with-configuration"><i class="fas fa-question-circle"></i></span>

        <input type="file" id="fileInput" accept=".ktlcfg" style="display:none;">

        <!-- Modal -->
        <div class="modal fade" id="loadConfigModal" tabindex="-1" role="dialog" aria-labelledby="loadConfigModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="loadConfigModalLabel">Load Configuration</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <ul id="configList" class="list-group">
                            <!-- Configurations will be listed here -->
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row">
                <!--<div class="col-lg-6">-->
                <div class="col-lg-12">
                    <form id="ktlConfigForm">
                        <fieldset class="form-group border p-3">
                            <legend data-section-id="core-settings">
                                Core Settings
                                <span class="legend-help-icon" data-section-id="core-settings"><i class="fas fa-question-circle"></i></span>
                            </legend>
                            <div>
                                <label>Developer Names (comma-separated):</label>
                                <input type="text" class="form-control" id="developerNames" placeholder="Firstname Lastname">
                            </div>
                            <div>
                                <label>Developer Email:</label>
                                <input type="email" class="form-control" id="developerEmail" placeholder="yourmail@provider.com">
                            </div>
                            <div>
                                <label>Developer Options PIN:</label>
                                <input type="text" class="form-control" id="devOptionsPin" placeholder="0000">
                            </div>
                        </fieldset>

                        <fieldset class="form-group border p-3">
                            <legend data-section-id="general-features">
                                General Feature Settings
                                <span class="legend-help-icon" data-section-id="general-features"><i class="fas fa-question-circle"></i></span>
                            </legend>

                            <fieldset class="form-group border p-3">
                                <legend data-section-id="version-info-bar">
                                    Version Info Bar
                                    <span class="legend-help-icon" data-section-id="version-info-bar"><i class="fas fa-question-circle"></i></span>
                                </legend>
                                <div class="checkbox-inline">
                                    <label for="viShowAppInfo">Show App Info</label>
                                    <input type="checkbox" id="viShowAppInfo" checked><br>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="viShowKtlInfo">Show KTL Info</label>
                                    <input type="checkbox" id="viShowKtlInfo" checked><br>
                                </div>
                                <div class="form-inline">
                                    <label for="viShowToRoles">Show to These Roles Only</label>
                                    <input type="text" class="form-control" id="viShowToRoles" placeholder="Developer" value="Developer">
                                </div>
                                <div class="form-inline">
                                    <label for="viPosX">Default Horizontal Pos</label>
                                    <select class="form-control" id="viPosX">
                                        <option value="right">Right</option>
                                        <option value="center">Center</option>
                                        <option value="left">Left</option>
                                    </select>
                                </div>
                                <div class="form-inline">
                                    <label for="viPosY">Default Vertical Position</label>
                                    <select class="form-control" id="viPosY">
                                        <option value="top">Top</option>
                                        <option value="bottom">Bottom</option>
                                    </select>
                                </div>
                                <div class="form-inline">
                                    <label for="viPosXMobile">Mobile Horizontal Pos</label>
                                    <select class="form-control" id="viPosXMobile">
                                        <option value="center">Center</option>
                                        <option value="left">Left</option>
                                        <option value="right">Right</option>
                                    </select>
                                </div>
                                <div class="form-inline">
                                    <label for="viPosYMobile">Mobile Vertical Position</label>
                                    <select class="form-control" id="viPosYMobile">
                                        <option value="bottom">Bottom</option>
                                        <option value="top">Top</option>
                                    </select>
                                </div>

                                <div class="form-inline">
                                    <label for="viOpacity">Default Opacity</label>
                                    <input type="number" class="form-control" id="viOpacity" placeholder="50" value="50">
                                </div>
                                <div class="form-inline">
                                    <label for="viOpacityHover">Opacity on Hover</label>
                                    <input type="number" class="form-control" id="viOpacityHover" placeholder="100" value="100">
                                </div>
                            </fieldset>

                            <fieldset class="form-group border p-3">
                                <legend data-section-id="main-feature-switches">
                                    Main Feature Switches
                                    <span class="legend-help-icon" data-section-id="main-feature-switches"><i class="fas fa-question-circle"></i></span>
                                </legend>
                                <div class="checkbox-inline">
                                    <label for="showMenuInTitle">Show Menu in Title</label>
                                    <input type="checkbox" id="showMenuInTitle" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="selTextOnFocus">Select Text on Focus</label>
                                    <input type="checkbox" id="selTextOnFocus" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="inlineEditColor">Inline Edit Color</label>
                                    <input type="checkbox" id="inlineEditColor" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="rowHoverHighlight">Row Hover Highlight</label>
                                    <input type="checkbox" id="rowHoverHighlight" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="autoFocus">Auto Focus</label>
                                    <input type="checkbox" id="autoFocus" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="sortedMenus">Sorted Menus</label>
                                    <input type="checkbox" id="sortedMenus" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="userFilters">User Filters</label>
                                    <input type="checkbox" id="userFilters" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="persistentForm">Persistent Form</label>
                                    <input type="checkbox" id="persistentForm" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="calendarGotoDate">Calendar Go To Date</label>
                                    <input type="checkbox" id="calendarGotoDate" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="rememberMe">Remember Me</label>
                                    <input type="checkbox" id="rememberMe" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="formPreValidation">Form Pre Validation</label>
                                    <input type="checkbox" id="formPreValidation" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="spinnerWatchDog">Spinner Watchdog</label>
                                    <input type="checkbox" id="spinnerWatchDog" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="idleWatchDog">Idle Watchdog</label>
                                    <input type="checkbox" id="idleWatchDog" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="debugWnd">Debug Window</label>
                                    <input type="checkbox" id="debugWnd" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="devInfoPopup">Dev Info Popup</label>
                                    <input type="checkbox" id="devInfoPopup" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="devPauseAutoRefresh">Dev Pause Auto Refresh</label>
                                    <input type="checkbox" id="devPauseAutoRefresh" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="virtualKeyboard">Virtual Keyboard</label>
                                    <input type="checkbox" id="virtualKeyboard">
                                </div>
                                <div class="checkbox-inline">
                                    <label for="iFrameWnd">iFrameWnd</label>
                                    <input type="checkbox" id="iFrameWnd">
                                </div>
                            </fieldset>

                            <fieldset class="form-group border p-3">
                                <legend data-section-id="bulk-operations">
                                    Bulk Operations
                                    <span class="legend-help-icon" data-section-id="bulk-operations"><i class="fas fa-question-circle"></i></span>
                                </legend>
                                <div class="checkbox-inline">
                                    <label for="bulkEdit">Bulk Edit</label>
                                    <input type="checkbox" id="bulkEdit" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="bulkCopy">Bulk Copy</label>
                                    <input type="checkbox" id="bulkCopy" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="bulkDelete">Bulk Delete</label>
                                    <input type="checkbox" id="bulkDelete" checked>
                                </div>
                            </fieldset>


                            <fieldset class="form-group border p-3">
                                <legend data-section-id="popup-style">
                                    Popup Style
                                    <span class="legend-help-icon" data-section-id="popup-style"><i class="fas fa-question-circle"></i></span>
                                </legend>
                                <div class="form-inline">
                                    <label for="popupStyleSuccess">Success</label>
                                    <input type="text" class="form-control" id="popupStyleSuccess" value=";background-color:#81b378;border:5px solid #294125">
                                </div>
                                <div class="form-inline">
                                    <label for="popupStyleWarning">Warning</label>
                                    <input type="text" class="form-control" id="popupStyleWarning" value=";background-color:#fffa5e;border:2px solid #7e8060">
                                </div>
                                <div class="form-inline">
                                    <label for="popupStyleError">Error</label>
                                    <input type="text" class="form-control" id="popupStyleError" value=";background-color:#FFB0B0;border:5px solid #660000">
                                </div>
                            </fieldset>

                            <fieldset class="form-group border p-3">
                                <legend data-section-id="tooltip-styles">
                                    Tooltip Styles
                                    <span class="legend-help-icon" data-section-id="tooltip-styles"><i class="fas fa-question-circle"></i></span>
                                </legend>
                                <div class="form-inline">
                                    <label for="ktlTtipFormViewBgColor">Form View Background Color</label>
                                    <input type="text" class="form-control" id="ktlTtipFormViewBgColor" value="#222222">
                                </div>
                                <div class="form-inline">
                                    <label for="ktlTtipFormViewTxtColor">Form View Text Color</label>
                                    <input type="text" class="form-control" id="ktlTtipFormViewTxtColor" value="#ffffff">
                                </div>
                                <div class="form-inline">
                                    <label for="ktlTtipIconFormViewColor">Form View Icon Color</label>
                                    <input type="text" class="form-control" id="ktlTtipIconFormViewColor" value="#222222">
                                </div>
                                <div class="form-inline">
                                    <label for="ktlTtipDetailsViewBgColor">Details/List View Background Color</label>
                                    <input type="text" class="form-control" id="ktlTtipDetailsViewBgColor" value="#222222">
                                </div>
                                <div class="form-inline">
                                    <label for="ktlTtipDetailsViewTxtColor">Details/List View Text Color</label>
                                    <input type="text" class="form-control" id="ktlTtipDetailsViewTxtColor" value="#ffffff">
                                </div>
                                <div class="form-inline">
                                    <label for="ktlTtipIconDetailsViewColor">Details/List View Icon Color</label>
                                    <input type="text" class="form-control" id="ktlTtipIconDetailsViewColor" value="#222222">
                                </div>
                                <div class="form-inline">
                                    <label for="ktlTtipTableViewBgColor">Table View Background Color</label>
                                    <input type="text" class="form-control" id="ktlTtipTableViewBgColor" value="#222222">
                                </div>
                                <div class="form-inline">
                                    <label for="ktlTtipTableViewTxtColor">Table View Text Color</label>
                                    <input type="text" class="form-control" id="ktlTtipTableViewTxtColor" value="#ffffff">
                                </div>
                                <div class="form-inline">
                                    <label for="ktlTtipIconTableViewColor">Table View Icon Color</label>
                                    <input type="text" class="form-control" id="ktlTtipIconTableViewColor" value="#222222">
                                </div>
                            </fieldset>
                        </fieldset>

                        <fieldset class="form-group border p-3">
                            <legend data-section-id="scenes">
                                Scenes
                                <span class="legend-help-icon" data-section-id="scenes"><i class="fas fa-question-circle"></i></span>
                            </legend>
                            <div class="form-inline">
                                <label for="versionDisplayName">Version Display Name</label>
                                <input type="text" class="form-control" id="versionDisplayName" placeholder="My App Name">
                            </div>
                            <div class="form-inline">
                                <label for="idleWatchDogDelay">Idle Watchdog Delay (ms)</label>
                                <input type="number" class="form-control" id="idleWatchDogDelay" value="7200000" placeholder="120 * 60000">
                            </div>
                            <div class="form-inline">
                                <label for="spinnerCtrDelay">Spinner Watchdog Delay (seconds)</label>
                                <input type="number" class="form-control" id="spinnerCtrDelay" value="60" placeholder="60">
                            </div>
                            <div class="form-inline">
                                <label for="spinnerWdExcludeScn">Spinner WatchDog Exclude Scenes (comma-separated IDs)</label>
                                <input type="text" class="form-control" id="spinnerWdExcludeScn" placeholder="scene_1, scene_2, ...">
                            </div>
                        </fieldset>

                        <fieldset class="form-group border p-3">
                            <legend data-section-id="views">
                                Views
                                <span class="legend-help-icon" data-section-id="views"><i class="fas fa-question-circle"></i></span>
                            </legend>
                            <fieldset class="form-group border p-3">
                                <legend data-section-id="quick-toggle">
                                    Quick Toggle
                                    <span class="legend-help-icon" data-section-id="quick-toggle"><i class="fas fa-question-circle"></i></span>
                                </legend>
                                <div class="form-inline">
                                    <label for="bgColorTrue">Background Color (True)</label>
                                    <input type="text" class="form-control" id="bgColorTrue" value="#39d91f">
                                </div>
                                <div class="form-inline">
                                    <label for="bgColorFalse">Background Color (False)</label>
                                    <input type="text" class="form-control" id="bgColorFalse" value="#f04a3b">
                                </div>
                                <div class="form-inline">
                                    <label for="bgColorPending">Background Color (Pending)</label>
                                    <input type="text" class="form-control" id="bgColorPending" value="#dd08">
                                </div>
                                <div class="checkbox-inline">
                                    <label for="showSpinner">Show Spinner</label>
                                    <input type="checkbox" id="showSpinner" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="showNotification">Show Notification</label>
                                    <input type="checkbox" id="showNotification" checked>
                                </div>
                                <div class="checkbox-inline">
                                    <label for="pendingClass">Pending Class</label>
                                    <input type="checkbox" id="pendingClass" checked>
                                </div>
                            </fieldset>

                            <div class="checkbox-inline">
                                <label for="headerAlignment">Global Header Alignment</label>
                                <input type="checkbox" id="headerAlignment" checked>
                            </div>
                            <div class="form-inline">
                                <label for="ktlFlashRate">KTL Flash Rate</label>
                                <input type="text" class="form-control" id="ktlFlashRate" value="1">
                            </div>
                            <div class="form-inline">
                                <label for="ktlOutlineColor">KTL Outline Color</label>
                                <input type="text" class="form-control" id="ktlOutlineColor" value="green">
                            </div>
                            <div class="form-inline">
                                <label for="hscCollapsedColumnsWidth">HSC Collapsed Columns Width (in pixels)</label>
                                <input type="number" class="form-control" id="hscCollapsedColumnsWidth" value="5">
                            </div>
                            <div class="checkbox-inline">
                                <label for="hscGlobal">Global Hide/Show Columns</label>
                                <input type="checkbox" id="hscGlobal" checked>
                            </div>
                        </fieldset>

                        <fieldset class="form-group border p-3">
                            <legend data-section-id="fields">
                                Fields
                                <span class="legend-help-icon" data-section-id="fields"><i class="fas fa-question-circle"></i></span>
                            </legend>
                            <div class="form-inline">
                                <label for="textAsNumeric">Text As Numeric (comma-separated field IDs)</label>
                                <input type="text" class="form-control" id="textAsNumeric" placeholder="field_1, field_2, ...">
                            </div>
                            <div class="form-inline">
                                <label for="textAsNumericExcludeScenes">Exclude Scenes (comma-separated scene IDs)</label>
                                <input type="text" class="form-control" id="textAsNumericExcludeScenes" placeholder="scene_1, scene_2, ...">
                            </div>
                            <div class="checkbox-inline">
                                <label for="horizontalRadioButtons">Horizontal Radio Buttons</label>
                                <input type="checkbox" id="horizontalRadioButtons">
                            </div>
                            <div class="checkbox-inline">
                                <label for="horizontalCheckboxes">Horizontal Checkboxes</label>
                                <input type="checkbox" id="horizontalCheckboxes">
                            </div>
                            <div class="form-inline">
                                <label for="barcodeTimeout">Barcode Timeout (miiliseconds)</label>
                                <input type="number" class="form-control" id="barcodeTimeout" value="20">
                            </div>
                            <div class="form-inline">
                                <label for="barcodeMinLength">Barcode Minimum Length</label>
                                <input type="number" class="form-control" id="barcodeMinLength" value="3">
                            </div>
                            <div class="checkbox-inline">
                                <label for="convertNumToTel">Convert Number to Tel</label>
                                <input type="checkbox" id="convertNumToTel" checked>
                            </div>
                        </fieldset>

                        <fieldset class="form-group border p-3">
                            <legend data-section-id="persistent-forms">
                                Persistent Forms
                                <span class="legend-help-icon" data-section-id="persistent-forms"><i class="fas fa-question-circle"></i></span>
                            </legend>
                            <div class="form-inline">
                                <label for="persistentFormsScenesToExclude">Scenes to Exclude (comma-separated IDs)</label>
                                <input type="text" class="form-control" id="persistentFormsScenesToExclude" placeholder="scene_1, scene_2, ...">
                            </div>
                            <div class="form-inline">
                                <label for="persistentFormsFieldsToExclude">Fields to Exclude (comma-separated IDs)</label>
                                <input type="text" class="form-control" id="persistentFormsFieldsToExclude" placeholder="field_1, field_2, ...">
                            </div>
                        </fieldset>

                        <fieldset class="form-group border p-3">
                            <legend data-section-id="system-colors">
                                System Colors
                                <span class="legend-help-icon" data-section-id="system-colors"><i class="fas fa-question-circle"></i></span>
                            </legend>
                            <div class="form-inline">
                                <label for="inlineEditBkgColor">Inline Edit Background Color</label>
                                <input type="text" class="form-control" id="inlineEditBkgColor" placeholder="e.g., #ffffff or paleLowSatClrTransparent">
                            </div>
                            <div class="form-inline">
                                <label for="inlineEditFontWeight">Inline Edit Font Weight</label>
                                <input type="text" class="form-control" id="inlineEditFontWeight" placeholder="e.g., bold or 600">
                            </div>
                            <div class="form-inline">
                                <label for="tableRowHoverBkgColor">Table Row Hover Background Color</label>
                                <input type="text" class="form-control" id="tableRowHoverBkgColor" placeholder="e.g., #a0454b75 or mistyrose">
                            </div>
                        </fieldset>

                        <fieldset class="form-group border p-3">
                            <legend data-section-id="advanced-settings">
                                Advanced Settings
                                <span class="legend-help-icon" data-section-id="advanced-settings"><i class="fas fa-question-circle"></i></span>
                            </legend>
                            <fieldset class="form-group border p-3">
                                <legend data-section-id="iframewnd">
                                    iFrameWnd
                                    <span class="legend-help-icon" data-section-id="iframewnd"><i class="fas fa-question-circle"></i></span>
                                </legend>
                                <div class="checkbox-inline">
                                    <label for="sendHeartbeat">Send Heartbeat</label>
                                    <input type="checkbox" id="sendHeartbeat" checked>
                                </div>
                            </fieldset>

                            <fieldset class="form-group border p-3">
                                <legend data-section-id="logging">
                                    Logging
                                    <span class="legend-help-icon" data-section-id="logging"><i class="fas fa-question-circle"></i></span>
                                </legend>
                                <div class="checkbox-inline">
                                    <label for="logCritical">Critical</label>
                                    <input type="checkbox" id="logCritical">
                                </div>
                                <div class="checkbox-inline">
                                    <label for="logError">Error</label>
                                    <input type="checkbox" id="logError">
                                </div>
                                <div class="checkbox-inline">
                                    <label for="logServerErr">Server Error</label>
                                    <input type="checkbox" id="logServerErr">
                                </div>
                                <div class="checkbox-inline">
                                    <label for="logWarning">Warning</label>
                                    <input type="checkbox" id="logWarning">
                                </div>
                                <div class="checkbox-inline">
                                    <label for="logInfo">Info</label>
                                    <input type="checkbox" id="logInfo">
                                </div>
                                <div class="checkbox-inline">
                                    <label for="logDebug">Debug</label>
                                    <input type="checkbox" id="logDebug">
                                </div>
                                <div class="checkbox-inline">
                                    <label for="logLogin">Login</label>
                                    <input type="checkbox" id="logLogin">
                                </div>
                                <div class="checkbox-inline">
                                    <label for="logActivity">Activity</label>
                                    <input type="checkbox" id="logActivity">
                                </div>
                                <div class="checkbox-inline">
                                    <label for="logNavigation">Navigation</label>
                                    <input type="checkbox" id="logNavigation">
                                </div>
                            </fieldset>

                            <fieldset class="form-group border p-3">
                                <legend data-section-id="kiosk">
                                    Kiosk
                                    <span class="legend-help-icon" data-section-id="kiosk"><i class="fas fa-question-circle"></i></span>
                                </legend>
                                <fieldset class="form-group">
                                    <legend data-section-id="kiosk">Refresh Button</legend>
                                    <div class="form-group">
                                        <label for="addRefreshHtml">HTML</label>
                                        <input type="text" class="form-control" id="addRefreshHtml" value="&lt;i class=&quot;fa fa-refresh&quot;&gt;&lt;/i&gt;">
                                    </div>
                                    <div class="form-group">
                                        <label for="addRefreshId">ID</label>
                                        <input type="text" class="form-control" id="addRefreshId" value="kn-button-refresh">
                                    </div>
                                    <div class="form-group">
                                        <label for="addRefreshHref">href</label>
                                        <input type="text" class="form-control" id="addRefreshHref" value="function () { location.reload(); }">
                                    </div>
                                    <div class="form-inline">
                                        <label for="addRefreshScenesToExclude">Scenes to Exclude (comma-separated IDs)</label>
                                        <input type="text" class="form-control" id="addRefreshScenesToExclude" placeholder="scene_1, scene_2, ...">
                                    </div>
                                </fieldset>

                                <fieldset class="form-group">
                                    <legend data-section-id="kiosk">Back Button</legend>
                                    <div class="form-group">
                                        <label for="addBackHtml">HTML</label>
                                        <input type="text" class="form-control" id="addBackHtml" value="&lt;i class=&quot;fa fa-arrow-left&quot;&gt;&lt;/i&gt;">
                                    </div>
                                    <div class="form-group">
                                        <label for="addBackId">ID</label>
                                        <input type="text" class="form-control" id="addBackId" value="kn-button-back">
                                    </div>
                                    <div class="form-group">
                                        <label for="addBackHref">href</label>
                                        <input type="text" class="form-control" id="addBackHref" value="function () { window.history.back(); }">
                                    </div>
                                    <div class="form-inline">
                                        <label for="affBackScenesToExclude">Scenes to Exclude (comma-separated IDs)</label>
                                        <input type="text" class="form-control" id="addBackScenesToExclude" placeholder="scene_1, scene_2, ...">
                                    </div>
                                </fieldset>

                                <fieldset class="form-group">
                                    <legend data-section-id="kiosk">Done Button</legend>
                                    <div class="form-group">
                                        <label for="addDoneHtml">HTML</label>
                                        <input type="text" class="form-control" id="addDoneHtml" value="&lt;i class=&quot;fa fa-check-square-o&quot;&gt;&lt;/i&gt;">
                                    </div>
                                    <div class="form-group">
                                        <label for="addDoneId">ID</label>
                                        <input type="text" class="form-control" id="addDoneId" value="kn-button-done">
                                    </div>
                                    <div class="form-group">
                                        <label for="addDoneHref">href</label>
                                        <input type="text" class="form-control" id="addDoneHref" value="function () { /* Your done function here */ }">
                                    </div>
                                    <div class="form-inline">
                                        <label for="addDoneScenesToExclude">Scenes to Exclude (comma-separated IDs)</label>
                                        <input type="text" class="form-control" id="addDoneScenesToExclude" placeholder="scene_1, scene_2, ...">
                                    </div>
                                </fieldset>
                            </fieldset>
                        </fieldset>
                        <button type="button" class="btn btn-primary" id="generateConfigBtn">Generate Configuration</button>
                        <button type="button" class="btn btn-secondary" id="copyToClipboardBtn">Copy to Clipboard</button>
                    </form>
                </div>

                <!--<div class="col-lg-6">
                    <iframe id="documentationIframe" src="https://github.com/cortexrd/Knack-Toolkit-Library/wiki/Customizing-Features#the-ktl-configurator-app" style="position:sticky; top:20px; height:80vh; width:100%;"></iframe>
                </div>-->
            </div>
        </div>
        <textarea id="generatedConfig" rows="100" class="form-control" style="margin-top: 20px; <!--width: 60em !important;-->"></textarea>
    </div>

    <div id="colorPickerContainer" style="cursor: move; position: fixed; top: 70px; right: 5%; background: gray; padding: 10px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">

        <div id="grabber">
            <div class="dot-container">
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
            <div class="dot-container">
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
            <div class="dot-container">
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>

        <div style="width: 20px; height: 100%; position: absolute; left: 20px; top: 50%; transform: translateY(-50%); cursor: grab; border-top-left-radius: 5px; border-bottom-left-radius: 5px;">
        </div>

        <input type="color" id="colorPicker" style="margin-left: 20px;">
        <button id="copyColor">Copy Color</button>
    </div>

    <div id="popupContainer" style="position: fixed; top: 20px; right: 20px; z-index: 1000;"></div>

    <script>
        const KTL_CONGURATOR_VERSION = '1.0.0';
        const documentationBaseURL = 'https://github.com/cortexrd/Knack-Toolkit-Library/wiki/Customizing-Features';

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('appVersion').textContent = 'v' + KTL_CONGURATOR_VERSION;

            const numberOfColors = 6;

            const colorClasses = Array.from({ length: numberOfColors }, (_, i) => `fieldset-color-${i + 1}`);

            const fieldsets = document.querySelectorAll('fieldset');
            let colorIndex = 0;

            fieldsets.forEach(function (fieldset) {
                fieldset.classList.add(colorClasses[colorIndex]);
                colorIndex = (colorIndex + 1) % colorClasses.length;
            });

            var dragItem = document.querySelector("#grabber");
            var active = false;
            var currentX;
            var currentY;
            var initialX;
            var initialY;
            var xOffset = 0;
            var yOffset = 0;

            dragItem.addEventListener("mousedown", dragStart, false);
            document.addEventListener("mouseup", dragEnd, false);
            document.addEventListener("mousemove", drag, false);

            dragItem.addEventListener("touchstart", dragStart, false);
            document.addEventListener("touchend", dragEnd, false);
            document.addEventListener("touchmove", drag, false);

            function dragStart(e) {
                if (e.type === "touchstart") {
                    // Prevent the default touch action (scroll / zoom)
                    e.preventDefault();

                    // Use the first touch point for the initial position
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }

                const hasGrabber = e.target.closest('#grabber');
                if (hasGrabber) {
                    active = true;
                }

                // Create and append the overlay to the iframe
                var iframe = document.getElementById('documentationIframe');
                var overlay = document.createElement('div');
                overlay.className = 'iframe-overlay';
                overlay.id = 'iframeOverlay'; // Easy identification for removal
                iframe.parentElement.insertBefore(overlay, iframe);
            }

            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                active = false;

                // Remove the overlay from the iframe
                var overlay = document.getElementById('iframeOverlay');
                if (overlay) {
                    overlay.parentElement.removeChild(overlay);
                }
            }

            function drag(e) {
                if (active) {
                    e.preventDefault();

                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }

                    xOffset = currentX;
                    yOffset = currentY;

                    setTranslate(currentX, currentY, dragItem);
                }
            }

            function setTranslate(xPos, yPos, el) {
                const dndContainer = el.closest('#colorPickerContainer');
                dndContainer.style.transform = "translate3d(" + xPos + "px, " + yPos + "px, 0)";
            }

            const existingConfigs = JSON.parse(localStorage.getItem('ktlConfigurations')) || { configs: {} };
            const latestAppName = existingConfigs.latestAppName || '';
            document.getElementById('appNameInput').value = latestAppName;
            if (latestAppName && existingConfigs.configs[latestAppName]) {
                applyConfiguration(existingConfigs.configs[latestAppName]);
            }

            document.querySelectorAll('.legend-help-icon').forEach(function (icon) {
                icon.addEventListener('click', function () {
                //    const sectionId = icon.getAttribute('data-section-id');
                //    const newIframeSrc = `${documentationBaseURL}#${sectionId}`;
                //    document.getElementById('documentationIframe').src = newIframeSrc;

                    const sectionId = icon.getAttribute('data-section-id');
                    const documentationURL = `https://github.com/cortexrd/Knack-Toolkit-Library/wiki/Customizing-Features#${sectionId}`;
                    window.open(documentationURL, 'documentationTab');
                });
            });

            document.getElementById('buttonsHelpIcon').addEventListener('click', function () {
                const iframe = document.getElementById('documentationIframe');
                iframe.style.visibility = 'collapse';
                setTimeout(() => {
                    window.scrollTo(0, 0);
                    iframe.style.visibility = 'visible';
                }, 100);
            });

            function scrollToTopOnce() {
                const iframe = document.getElementById('documentationIframe');
                setTimeout(() => {
                    // Remove the listener to ensure this happens only once
                    iframe.removeEventListener('load', scrollToTopOnce);
                    iframe.style.visibility = 'visible';
                    window.scrollTo(0, 0);
                }, 100);
            }

            //document.getElementById('documentationIframe').addEventListener('load', scrollToTopOnce);
        });

        document.getElementById('generateConfigBtn').addEventListener('click', function () {
            const developerNamesInput = document.getElementById('developerNames').value;
            const developerNames = developerNamesInput.split(', ').map(name => name.trim()).map(name => `'${name}'`);
            const developerEmail = document.getElementById('developerEmail').value;
            const devOptionsPin = document.getElementById('devOptionsPin').value;

            const rolesInput = document.getElementById('viShowToRoles').value;
            const roles = rolesInput.split(', ').map(role => role.trim()).filter(role => role).map(role => `'${role}'`);

            const enabled = {
                versionInfo: {
                    viShowAppInfo: document.getElementById('viShowAppInfo').checked,
                    viShowKtlInfo: document.getElementById('viShowKtlInfo').checked,
                    viShowToRoles: `[${roles}]`,
                    viPosX: document.getElementById('viPosX').value,
                    viPosY: document.getElementById('viPosY').value,
                    viPosXMobile: document.getElementById('viPosXMobile').value,
                    viPosYMobile: document.getElementById('viPosYMobile').value,
                    viOpacity: document.getElementById('viOpacity').value,
                    viOpacityHover: document.getElementById('viOpacityHover').value,
                },

                showMenuInTitle: document.getElementById('showMenuInTitle').checked,
                selTextOnFocus: document.getElementById('selTextOnFocus').checked,
                inlineEditColor: document.getElementById('inlineEditColor').checked,
                rowHoverHighlight: document.getElementById('rowHoverHighlight').checked,
                autoFocus: document.getElementById('autoFocus').checked,
                sortedMenus: document.getElementById('sortedMenus').checked,
                userFilters: document.getElementById('userFilters').checked,
                persistentForm: document.getElementById('persistentForm').checked,
                calendarGotoDate: document.getElementById('calendarGotoDate').checked,
                rememberMe: document.getElementById('rememberMe').checked,
                formPreValidation: document.getElementById('formPreValidation').checked,
                spinnerWatchDog: document.getElementById('spinnerWatchDog').checked,
                idleWatchDog: document.getElementById('idleWatchDog').checked,
                debugWnd: document.getElementById('debugWnd').checked,
                devInfoPopup: document.getElementById('devInfoPopup').checked,
                devPauseAutoRefresh: document.getElementById('devPauseAutoRefresh').checked,
                virtualKeyboard: document.getElementById('virtualKeyboard').checked,
                iFrameWnd: document.getElementById('iFrameWnd').checked,

                bulkOps: {
                    bulkEdit: document.getElementById('bulkEdit').checked,
                    bulkCopy: document.getElementById('bulkCopy').checked,
                    bulkDelete: document.getElementById('bulkDelete').checked,
                },
            };

            const popupStyle = {
                success: document.getElementById('popupStyleSuccess').value,
                warning: document.getElementById('popupStyleWarning').value,
                error: document.getElementById('popupStyleError').value,
            };

            const tooltipStyles = {
                ktlTtipFormViewBgColor: document.getElementById('ktlTtipFormViewBgColor').value,
                ktlTtipFormViewTxtColor: document.getElementById('ktlTtipFormViewTxtColor').value,
                ktlTtipIconFormViewColor: document.getElementById('ktlTtipIconFormViewColor').value,
                ktlTtipDetailsViewBgColor: document.getElementById('ktlTtipDetailsViewBgColor').value,
                ktlTtipDetailsViewTxtColor: document.getElementById('ktlTtipDetailsViewTxtColor').value,
                ktlTtipIconDetailsViewColor: document.getElementById('ktlTtipIconDetailsViewColor').value,
                ktlTtipTableViewBgColor: document.getElementById('ktlTtipTableViewBgColor').value,
                ktlTtipTableViewTxtColor: document.getElementById('ktlTtipTableViewTxtColor').value,
                ktlTtipIconTableViewColor: document.getElementById('ktlTtipIconTableViewColor').value,
            };

            let versionDisplayName = document.getElementById('versionDisplayName').value;
            let idleWatchDogDelay = document.getElementById('idleWatchDogDelay').value;
            let spinnerCtrDelay = document.getElementById('spinnerCtrDelay').value;
            let spinnerWdExcludeScn = document.getElementById('spinnerWdExcludeScn').value.split(', ').map(scn => `'${scn.trim()}'`);

            const quickToggleParams = {
                bgColorTrue: document.getElementById('bgColorTrue').value,
                bgColorFalse: document.getElementById('bgColorFalse').value,
                bgColorPending: document.getElementById('bgColorPending').value,
                showSpinner: document.getElementById('showSpinner').checked,
                showNotification: document.getElementById('showNotification').checked,
                pendingClass: document.getElementById('pendingClass').checked,
            };

            const fieldsSettings = {
                textAsNumeric: document.getElementById('textAsNumeric').value.split(', ').map(id => `'${id.trim()}'`),
                textAsNumericExcludeScenes: document.getElementById('textAsNumericExcludeScenes').value.split(', ').map(id => `'${id.trim()}'`),
                horizontalRadioButtons: document.getElementById('horizontalRadioButtons').checked,
                horizontalCheckboxes: document.getElementById('horizontalCheckboxes').checked,
                barcodeTimeout: parseInt(document.getElementById('barcodeTimeout').value, 10),
                barcodeMinLength: parseInt(document.getElementById('barcodeMinLength').value, 10),
                convertNumToTel: document.getElementById('convertNumToTel').checked,
            };

            const persistentFormsSettings = {
                scenesToExclude: document.getElementById('persistentFormsScenesToExclude').value.split(', ').map(id => `'${id.trim()}'`),
                fieldsToExclude: document.getElementById('persistentFormsFieldsToExclude').value.split(', ').map(id => `'${id.trim()}'`),
            };

            const systemColorsSettings = {
                inlineEditBkgColor: document.getElementById('inlineEditBkgColor').value,
                inlineEditFontWeight: document.getElementById('inlineEditFontWeight').value,
                tableRowHoverBkgColor: document.getElementById('tableRowHoverBkgColor').value
            };

            const addRefreshHtml = document.getElementById('addRefreshHtml').value;
            const addRefreshId = document.getElementById('addRefreshId').value;
            const addRefreshHref = document.getElementById('addRefreshHref').value;
            const addRefreshInput = document.getElementById('addRefreshScenesToExclude').value;
            const addRefreshScenesToExclude = addRefreshInput.split(', ').map(id => `'${id.trim()}'`);

            const addBackHtml = document.getElementById('addBackHtml').value;
            const addBackId = document.getElementById('addBackId').value;
            const addBackHref = document.getElementById('addBackHref').value;
            const addBackInput = document.getElementById('addRefreshScenesToExclude').value;
            const addBackScenesToExclude = addBackInput.split(', ').map(id => `'${id.trim()}'`);

            const addDoneHtml = document.getElementById('addDoneHtml').value;
            const addDoneId = document.getElementById('addDoneId').value;
            const addDoneHref = document.getElementById('addDoneHref').value;
            const addDoneInput = document.getElementById('addRefreshScenesToExclude').value;
            const addDoneScenesToExclude = addDoneInput.split(', ').map(id => `'${id.trim()}'`);

            const logEnabled = {
                critical: document.getElementById('logCritical').checked,
                error: document.getElementById('logError').checked,
                serverErr: document.getElementById('logServerErr').checked,
                warning: document.getElementById('logWarning').checked,
                info: document.getElementById('logInfo').checked,
                debug: document.getElementById('logDebug').checked,
                login: document.getElementById('logLogin').checked,
                activity: document.getElementById('logActivity').checked,
                navigation: document.getElementById('logNavigation').checked,
            };

            let configScript = `
window.APP_VERSION = '1.0.0';

window.ktlReady = function (appInfo = {}) {
    var ktl = new Ktl($, appInfo);

    ktl.core.setCfg({
        developerNames: [${developerNames.join(', ')}],
        developerEmail: '${developerEmail}',
        devOptionsPin: '${devOptionsPin}',

        //Main KTL feature switches.  Here is where your App can override the defaults and enable/disable the features.
        enabled: {
            versionInfo: {
                viShowAppInfo: ${enabled.versionInfo.viShowAppInfo},
                viShowKtlInfo: ${enabled.versionInfo.viShowKtlInfo},
                viShowToRoles: ${enabled.versionInfo.viShowToRoles},
                viPosX: '${enabled.versionInfo.viPosX}',
                viPosY: '${enabled.versionInfo.viPosY}',
                viPosXMobile: '${enabled.versionInfo.viPosXMobile}',
                viPosYMobile: '${enabled.versionInfo.viPosYMobile}',
                viOpacity: ${enabled.versionInfo.viOpacity},
                viOpacityHover: ${enabled.versionInfo.viOpacityHover},
            },

            showMenuInTitle: ${enabled.showMenuInTitle},
            selTextOnFocus: ${enabled.selTextOnFocus},
            inlineEditColor: ${enabled.inlineEditColor},
            rowHoverHighlight: ${enabled.rowHoverHighlight},
            autoFocus: ${enabled.autoFocus},
            sortedMenus: ${enabled.sortedMenus},
            userFilters: ${enabled.userFilters},
            persistentForm: ${enabled.persistentForm},
            calendarGotoDate: ${enabled.calendarGotoDate},
            rememberMe: ${enabled.rememberMe},
            formPreValidation: ${enabled.formPreValidation},
            spinnerWatchDog: ${enabled.spinnerWatchDog},
            idleWatchDog: ${enabled.idleWatchDog},
            debugWnd: ${enabled.debugWnd},
            devInfoPopup: ${enabled.devInfoPopup},
            devPauseAutoRefresh: ${enabled.devPauseAutoRefresh},
            virtualKeyboard: ${enabled.virtualKeyboard},

            //Those below must also be set up properly to have any effect.  See documentation.
            iFrameWnd: ${enabled.iFrameWnd},

            bulkOps: {
                bulkEdit: ${enabled.bulkOps.bulkEdit},
                bulkCopy: ${enabled.bulkOps.bulkCopy},
                bulkDelete: ${enabled.bulkOps.bulkDelete},
            },
        },

        popupStyle: {
            success: '${popupStyle.success}',
            warning: '${popupStyle.warning}',
            error: '${popupStyle.error}',
        },

        tooltipStyles: {
            ktlTtipFormViewBgColor: '${tooltipStyles.ktlTtipFormViewBgColor}',
            ktlTtipFormViewTxtColor: '${tooltipStyles.ktlTtipFormViewTxtColor}',
            ktlTtipIconFormViewColor: '${tooltipStyles.ktlTtipIconFormViewColor}',
            ktlTtipDetailsViewBgColor: '${tooltipStyles.ktlTtipDetailsViewBgColor}',
            ktlTtipDetailsViewTxtColor: '${tooltipStyles.ktlTtipDetailsViewTxtColor}',
            ktlTtipIconDetailsViewColor: '${tooltipStyles.ktlTtipIconDetailsViewColor}',
            ktlTtipTableViewBgColor: '${tooltipStyles.ktlTtipTableViewBgColor}',
            ktlTtipTableViewTxtColor: '${tooltipStyles.ktlTtipTableViewTxtColor}',
            ktlTtipIconTableViewColor: '${tooltipStyles.ktlTtipIconTableViewColor}',
        },

    });

    ktl.scenes.setCfg({
        versionDisplayName: '${versionDisplayName}',
        idleWatchDogDelay: ${idleWatchDogDelay},
        spinnerCtrDelay: ${spinnerCtrDelay},
        spinnerWdExcludeScn: [${spinnerWdExcludeScn.join(', ')}],
    });

    ktl.views.setCfg({
        quickToggleParams: {
            bgColorTrue: '${quickToggleParams.bgColorTrue}',
            bgColorFalse: '${quickToggleParams.bgColorFalse}',
            bgColorPending: '${quickToggleParams.bgColorPending}',
            showSpinner: ${quickToggleParams.showSpinner},
            showNotification: ${quickToggleParams.showNotification},
            pendingClass: ${quickToggleParams.pendingClass},
        },

        headerAlignment: ${document.getElementById('headerAlignment').checked},
        ktlFlashRate: '${document.getElementById('ktlFlashRate').value}',
        ktlOutlineColor: '${document.getElementById('ktlOutlineColor').value}',
        hscCollapsedColumnsWidth: '${document.getElementById('hscCollapsedColumnsWidth').value}',
        hscGlobal: ${document.getElementById('hscGlobal').checked},
    });

    ktl.fields.setCfg({
        textAsNumeric: [${fieldsSettings.textAsNumeric.join(', ')}],
        textAsNumericExcludeScenes: [${fieldsSettings.textAsNumericExcludeScenes.join(', ')}],
        horizontalRadioButtons: ${fieldsSettings.horizontalRadioButtons},
        horizontalCheckboxes: ${fieldsSettings.horizontalCheckboxes},
        barcodeTimeout: ${fieldsSettings.barcodeTimeout},
        barcodeMinLength: ${fieldsSettings.barcodeMinLength},
        convertNumToTel: ${fieldsSettings.convertNumToTel},
    });

    ktl.persistentForm.setCfg({
        scenesToExclude: [${persistentFormsSettings.scenesToExclude.join(', ')}],
        fieldsToExclude: [${persistentFormsSettings.fieldsToExclude.join(', ')}],
    });

    ktl.systemColors.setCfg({
        inlineEditBkgColor: '${systemColorsSettings.inlineEditBkgColor}',
        inlineEditFontWeight: '${systemColorsSettings.inlineEditFontWeight}',
        tableRowHoverBkgColor: '${systemColorsSettings.tableRowHoverBkgColor}',
    });

    //Features that do not apply to the iFrameWnd.
    if (!window.self.frameElement) {
        ktl.scenes.setCfg({
            ktlKioskButtons: {
                ADD_REFRESH: {
                    html: '${addRefreshHtml}',
                    id: '${addRefreshId}',
                    href: ${addRefreshHref},
                    scenesToExclude: [${addRefreshScenesToExclude.join(', ')}],
                },
                ADD_BACK: {
                    html: '${addBackHtml}',
                    id: '${addBackId}',
                    href: ${addBackHref},
                    scenesToExclude: [${addBackScenesToExclude.join(', ')}],
                },
                ADD_DONE: {
                    html: '${addDoneHtml}',
                    id: '${addDoneId}',
                    href: ${addDoneHref},
                    scenesToExclude: [${addDoneScenesToExclude.join(', ')}],
                },
            },
        });
    }

    ktl.log.setCfg({
        logEnabled: {
            critical: ${logEnabled.critical},
            error: ${logEnabled.error},
            serverErr: ${logEnabled.serverErr},
            warning: ${logEnabled.warning},
            info: ${logEnabled.info},
            debug: ${logEnabled.debug},
            login: ${logEnabled.login},
            activity: ${logEnabled.activity},
            navigation: ${logEnabled.navigation},
        }
    });

    //KTL Setup - END


    //KTL callbacks to your App - BEGIN
    //KTL callbacks to your App - END

    /////////////////////////////////////////////////
    //Your App-specific code goes here...

};
`;

            document.getElementById('generatedConfig').value = configScript;
        });

        document.getElementById('copyToClipboardBtn').addEventListener('click', function () {
            const configText = document.getElementById('generatedConfig');
            configText.select();
            document.execCommand('copy');

            const originalButtonText = this.innerText;
            this.innerText = 'Copied!';
            setTimeout(() => this.innerText = originalButtonText, 2000);
        });

        function collectFormData() {
            const developerNames = document.getElementById('developerNames').value ? document.getElementById('developerNames').value.split(',').map(item => item.trim()).filter(item => item) : [];
            const viShowToRoles = document.getElementById('viShowToRoles').value ? document.getElementById('viShowToRoles').value.split(',').map(item => item.trim()).filter(item => item) : [];
            const spinnerWdExcludeScn = document.getElementById('spinnerWdExcludeScn').value ? document.getElementById('spinnerWdExcludeScn').value.split(',').map(item => item.trim()).filter(item => item) : [];
            const textAsNumeric = document.getElementById('textAsNumeric').value ? document.getElementById('textAsNumeric').value.split(',').map(item => item.trim()).filter(item => item) : [];
            const textAsNumericExcludeScenes = document.getElementById('textAsNumericExcludeScenes').value ? document.getElementById('textAsNumericExcludeScenes').value.split(',').map(item => item.trim()).filter(item => item) : [];
            const persistentFormsScenesToExclude = document.getElementById('persistentFormsScenesToExclude').value ? document.getElementById('persistentFormsScenesToExclude').value.split(',').map(item => item.trim()).filter(item => item) : [];
            const persistentFormsFieldsToExclude = document.getElementById('persistentFormsFieldsToExclude').value ? document.getElementById('persistentFormsFieldsToExclude').value.split(',').map(item => item.trim()).filter(item => item) : [];
            const addRefreshScenesToExclude = document.getElementById('addRefreshScenesToExclude').value ? document.getElementById('addRefreshScenesToExclude').value.split(',').map(item => item.trim()).filter(item => item) : [];
            const addBackScenesToExclude = document.getElementById('addBackScenesToExclude').value ? document.getElementById('addBackScenesToExclude').value.split(',').map(item => item.trim()).filter(item => item) : [];
            const addDoneScenesToExclude = document.getElementById('addDoneScenesToExclude').value ? document.getElementById('addDoneScenesToExclude').value.split(',').map(item => item.trim()).filter(item => item) : [];

            return {
                developerNames: developerNames,
                developerEmail: document.getElementById('developerEmail').value,
                devOptionsPin: document.getElementById('devOptionsPin').value,

                versionInfo: {
                    viShowAppInfo: document.getElementById('viShowAppInfo').checked,
                    viShowKtlInfo: document.getElementById('viShowKtlInfo').checked,
                    viShowToRoles: viShowToRoles,
                    viPosX: document.getElementById('viPosX').value,
                    viPosY: document.getElementById('viPosY').value,
                    viPosXMobile: document.getElementById('viPosXMobile').value,
                    viPosYMobile: document.getElementById('viPosYMobile').value,
                    viOpacity: parseInt(document.getElementById('viOpacity').value, 10),
                    viOpacityHover: parseInt(document.getElementById('viOpacityHover').value, 10),
                },

                featureSwitches: {
                    showMenuInTitle: document.getElementById('showMenuInTitle').checked,
                    selTextOnFocus: document.getElementById('selTextOnFocus').checked,
                    inlineEditColor: document.getElementById('inlineEditColor').checked,
                    rowHoverHighlight: document.getElementById('rowHoverHighlight').checked,
                    autoFocus: document.getElementById('autoFocus').checked,
                    sortedMenus: document.getElementById('sortedMenus').checked,
                    userFilters: document.getElementById('userFilters').checked,
                    persistentForm: document.getElementById('persistentForm').checked,
                    calendarGotoDate: document.getElementById('calendarGotoDate').checked,
                    rememberMe: document.getElementById('rememberMe').checked,
                    formPreValidation: document.getElementById('formPreValidation').checked,
                    spinnerWatchDog: document.getElementById('spinnerWatchDog').checked,
                    idleWatchDog: document.getElementById('idleWatchDog').checked,
                    debugWnd: document.getElementById('debugWnd').checked,
                    devInfoPopup: document.getElementById('devInfoPopup').checked,
                    devPauseAutoRefresh: document.getElementById('devPauseAutoRefresh').checked,
                    virtualKeyboard: document.getElementById('virtualKeyboard').checked,
                    iFrameWnd: document.getElementById('iFrameWnd').checked
                },

                bulkOps: {
                    bulkEdit: document.getElementById('bulkEdit').checked,
                    bulkCopy: document.getElementById('bulkCopy').checked,
                    bulkDelete: document.getElementById('bulkDelete').checked
                },

                popupStyle: {
                    success: document.getElementById('popupStyleSuccess').value,
                    warning: document.getElementById('popupStyleWarning').value,
                    error: document.getElementById('popupStyleError').value
                },

                tooltipStyles: {
                    ktlTtipFormViewBgColor: document.getElementById('ktlTtipFormViewBgColor').value,
                    ktlTtipFormViewTxtColor: document.getElementById('ktlTtipFormViewTxtColor').value,
                    ktlTtipIconFormViewColor: document.getElementById('ktlTtipIconFormViewColor').value,
                    ktlTtipDetailsViewBgColor: document.getElementById('ktlTtipDetailsViewBgColor').value,
                    ktlTtipDetailsViewTxtColor: document.getElementById('ktlTtipDetailsViewTxtColor').value,
                    ktlTtipIconDetailsViewColor: document.getElementById('ktlTtipIconDetailsViewColor').value,
                    ktlTtipTableViewBgColor: document.getElementById('ktlTtipTableViewBgColor').value,
                    ktlTtipTableViewTxtColor: document.getElementById('ktlTtipTableViewTxtColor').value,
                    ktlTtipIconTableViewColor: document.getElementById('ktlTtipIconTableViewColor').value
                },

                scenesSettings: {
                    versionDisplayName: document.getElementById('versionDisplayName').value,
                    idleWatchDogDelay: parseInt(document.getElementById('idleWatchDogDelay').value),
                    spinnerCtrDelay: parseInt(document.getElementById('spinnerCtrDelay').value),
                    spinnerWdExcludeScn: spinnerWdExcludeScn,
                },

                viewsSettings: {
                    quickToggleParams: {
                        bgColorTrue: document.getElementById('bgColorTrue').value,
                        bgColorFalse: document.getElementById('bgColorFalse').value,
                        bgColorPending: document.getElementById('bgColorPending').value,
                        showSpinner: document.getElementById('showSpinner').checked,
                        showNotification: document.getElementById('showNotification').checked,
                        pendingClass: document.getElementById('pendingClass').checked,
                    },
                    headerAlignment: document.getElementById('headerAlignment').checked,
                    ktlFlashRate: document.getElementById('ktlFlashRate').value,
                    ktlOutlineColor: document.getElementById('ktlOutlineColor').value,
                    hscCollapsedColumnsWidth: document.getElementById('hscCollapsedColumnsWidth').value,
                    hscGlobal: document.getElementById('hscGlobal').checked
                },

                fieldsSettings: {
                    textAsNumeric: textAsNumeric,
                    textAsNumericExcludeScenes: textAsNumericExcludeScenes,
                    horizontalRadioButtons: document.getElementById('horizontalRadioButtons').checked,
                    horizontalCheckboxes: document.getElementById('horizontalCheckboxes').checked,
                    barcodeTimeout: parseInt(document.getElementById('barcodeTimeout').value),
                    barcodeMinLength: parseInt(document.getElementById('barcodeMinLength').value),
                    convertNumToTel: document.getElementById('convertNumToTel').checked
                },

                persistentFormsSettings: {
                    scenesToExclude: persistentFormsScenesToExclude,
                    fieldsToExclude: persistentFormsFieldsToExclude,
                },

                systemColorsSettings: {
                    inlineEditBkgColor: document.getElementById('inlineEditBkgColor').value,
                    inlineEditFontWeight: document.getElementById('inlineEditFontWeight').value,
                    tableRowHoverBkgColor: document.getElementById('tableRowHoverBkgColor').value
                },

                kioskSettings: {
                    ADD_REFRESH: {
                        html: document.getElementById('addRefreshHtml').value,
                        id: document.getElementById('addRefreshId').value,
                        href: document.getElementById('addRefreshHref').value,
                        scenesToExclude: addRefreshScenesToExclude,
                    },
                    ADD_BACK: {
                        html: document.getElementById('addBackHtml').value,
                        id: document.getElementById('addBackId').value,
                        href: document.getElementById('addBackHref').value,
                        scenesToExclude: addBackScenesToExclude,
                    },
                    ADD_DONE: {
                        html: document.getElementById('addDoneHtml').value,
                        id: document.getElementById('addDoneId').value,
                        href: document.getElementById('addDoneHref').value,
                        scenesToExclude: addDoneScenesToExclude,
                    }
                },

                loggingSettings: {
                    logCritical: document.getElementById('logCritical').checked,
                    logError: document.getElementById('logError').checked,
                    logServerErr: document.getElementById('logServerErr').checked,
                    logWarning: document.getElementById('logWarning').checked,
                    logInfo: document.getElementById('logInfo').checked,
                    logDebug: document.getElementById('logDebug').checked,
                    logLogin: document.getElementById('logLogin').checked,
                    logActivity: document.getElementById('logActivity').checked,
                    logNavigation: document.getElementById('logNavigation').checked
                },

                iFrameWndSettings: {
                    sendHeartbeat: document.getElementById('sendHeartbeat').checked
                }
            }
        }

        document.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                e.preventDefault();

                const isFocusWithinForm = document.getElementById('ktlConfigForm').contains(document.activeElement) || document.activeElement.id === 'appNameInput';

                if (isFocusWithinForm) {
                    document.getElementById('saveBtn').click();
                }
            }
        });

        document.getElementById('exportToFileBtn').addEventListener('click', function () {
            const appName = document.getElementById('appNameInput').value.trim();
            if (!appName) {
                alert('Please enter an app name before saving.');
                return;
            }

            let filename = prompt("Enter a filename for your configuration:", `${appName}.ktlcfg`);
            if (filename) {
                if (!filename.endsWith('.ktlcfg')) {
                    filename += '.ktlcfg';
                }

                const formInputs = collectFormData();

                const dataStr = JSON.stringify(formInputs, null, 4);
                const blob = new Blob([dataStr], { type: "application/json" });

                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            } else {
                alert("File save cancelled.");
            }
        });

        function applyConfiguration(config) {
            try {
                if (config) {
                    document.getElementById('developerNames').value = config.developerNames.join(', ');
                    document.getElementById('developerEmail').value = config.developerEmail;
                    document.getElementById('devOptionsPin').value = config.devOptionsPin;

                    document.getElementById('viShowAppInfo').checked = config.versionInfo.viShowAppInfo;
                    document.getElementById('viShowKtlInfo').checked = config.versionInfo.viShowKtlInfo;
                    document.getElementById('viShowToRoles').value = config.versionInfo.viShowToRoles.join(', ');
                    document.getElementById('viPosX').value = config.versionInfo.viPosX;
                    document.getElementById('viPosY').value = config.versionInfo.viPosY;
                    document.getElementById('viPosXMobile').value = config.versionInfo.viPosXMobile;
                    document.getElementById('viPosYMobile').value = config.versionInfo.viPosYMobile;
                    document.getElementById('viOpacity').value = config.versionInfo.viOpacity;
                    document.getElementById('viOpacityHover').value = config.versionInfo.viOpacityHover;

                    Object.keys(config.featureSwitches).forEach(key => {
                        const checkbox = document.getElementById(key);
                        if (checkbox) checkbox.checked = config.featureSwitches[key];
                    });

                    Object.keys(config.bulkOps).forEach(key => {
                        const checkbox = document.getElementById(key);
                        if (checkbox) checkbox.checked = config.bulkOps[key];
                    });

                    document.getElementById('popupStyleSuccess').value = config.popupStyle.success;
                    document.getElementById('popupStyleWarning').value = config.popupStyle.warning;
                    document.getElementById('popupStyleError').value = config.popupStyle.error;

                    Object.keys(config.tooltipStyles).forEach(key => {
                        document.getElementById(key).value = config.tooltipStyles[key];
                    });

                    document.getElementById('versionDisplayName').value = config.scenesSettings.versionDisplayName;
                    document.getElementById('idleWatchDogDelay').value = config.scenesSettings.idleWatchDogDelay;
                    document.getElementById('spinnerCtrDelay').value = config.scenesSettings.spinnerCtrDelay;
                    document.getElementById('spinnerWdExcludeScn').value = config.scenesSettings.spinnerWdExcludeScn.join(', ');

                    const qtParams = config.viewsSettings.quickToggleParams;
                    document.getElementById('bgColorTrue').value = qtParams.bgColorTrue;
                    document.getElementById('bgColorFalse').value = qtParams.bgColorFalse;
                    document.getElementById('bgColorPending').value = qtParams.bgColorPending;
                    document.getElementById('showSpinner').checked = qtParams.showSpinner;
                    document.getElementById('showNotification').checked = qtParams.showNotification;
                    document.getElementById('pendingClass').checked = qtParams.pendingClass;
                    document.getElementById('headerAlignment').checked = config.viewsSettings.headerAlignment;
                    document.getElementById('ktlFlashRate').value = config.viewsSettings.ktlFlashRate;
                    document.getElementById('ktlOutlineColor').value = config.viewsSettings.ktlOutlineColor;
                    document.getElementById('hscCollapsedColumnsWidth').value = config.viewsSettings.hscCollapsedColumnsWidth;
                    document.getElementById('hscGlobal').checked = config.viewsSettings.hscGlobal;

                    document.getElementById('textAsNumeric').value = config.fieldsSettings.textAsNumeric.join(', ');
                    document.getElementById('textAsNumericExcludeScenes').value = config.fieldsSettings.textAsNumericExcludeScenes.join(', ');
                    document.getElementById('horizontalRadioButtons').checked = config.fieldsSettings.horizontalRadioButtons;
                    document.getElementById('horizontalCheckboxes').checked = config.fieldsSettings.horizontalCheckboxes;
                    document.getElementById('barcodeTimeout').value = config.fieldsSettings.barcodeTimeout;
                    document.getElementById('barcodeMinLength').value = config.fieldsSettings.barcodeMinLength;
                    document.getElementById('convertNumToTel').checked = config.fieldsSettings.convertNumToTel;

                    document.getElementById('persistentFormsScenesToExclude').value = config.persistentFormsSettings.scenesToExclude.join(', ');
                    document.getElementById('persistentFormsFieldsToExclude').value = config.persistentFormsSettings.fieldsToExclude.join(', ');

                    document.getElementById('inlineEditBkgColor').value = config.systemColorsSettings.inlineEditBkgColor;
                    document.getElementById('inlineEditFontWeight').value = config.systemColorsSettings.inlineEditFontWeight;
                    document.getElementById('tableRowHoverBkgColor').value = config.systemColorsSettings.tableRowHoverBkgColor;

                    if (config.kioskSettings) {
                        document.getElementById('addRefreshHtml').value = config.kioskSettings.ADD_REFRESH.html;
                        document.getElementById('addRefreshId').value = config.kioskSettings.ADD_REFRESH.id;
                        document.getElementById('addRefreshHref').value = config.kioskSettings.ADD_REFRESH.href;
                        document.getElementById('addRefreshScenesToExclude').value = config.kioskSettings.ADD_REFRESH.scenesToExclude.join(', ');

                        document.getElementById('addBackHtml').value = config.kioskSettings.ADD_BACK.html;
                        document.getElementById('addBackId').value = config.kioskSettings.ADD_BACK.id;
                        document.getElementById('addBackHref').value = config.kioskSettings.ADD_BACK.href;
                        document.getElementById('addBackScenesToExclude').value = config.kioskSettings.ADD_BACK.scenesToExclude.join(', ');

                        document.getElementById('addDoneHtml').value = config.kioskSettings.ADD_DONE.html;
                        document.getElementById('addDoneId').value = config.kioskSettings.ADD_DONE.id;
                        document.getElementById('addDoneHref').value = config.kioskSettings.ADD_DONE.href;
                        document.getElementById('addDoneScenesToExclude').value = config.kioskSettings.ADD_DONE.scenesToExclude.join(', ');
                    }

                    if (config.loggingSettings) {
                        Object.keys(config.loggingSettings).forEach(key => {
                            const checkbox = document.getElementById(key);
                            if (checkbox) checkbox.checked = config.loggingSettings[key];
                        });
                    }

                    if (config.iFrameWndSettings) {
                        document.getElementById('sendHeartbeat').checked = config.iFrameWndSettings.sendHeartbeat;
                    }

                    if (Array.isArray(config.developerNames)) {
                        document.getElementById('developerNames').value = config.developerNames.join(', ');
                    } else {
                        alert('Error - developerNames not an array.');
                    }

                }
            } catch (error) {
                console.log('applyConfiguration - Error reading config:\n', error);
            }
        }

        document.getElementById('importFromFileBtn').addEventListener('click', function () {
            document.getElementById('fileInput').click();
        });

        document.getElementById('fileInput').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (fileLoadEvent) {
                    const contents = fileLoadEvent.target.result;

                    try {
                        const config = JSON.parse(contents);
                        applyConfiguration(config);
                    } catch (error) {
                        alert('Error reading file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        });

        document.getElementById('saveBtn').addEventListener('click', function () {
            const appName = document.getElementById('appNameInput').value.trim();

            if (!appName) {
                alert('Please enter an app name before saving.');
                return;
            }

            const formInputs = collectFormData();

            const existingConfigs = JSON.parse(localStorage.getItem('ktlConfigurations')) || { configs: {} };

            existingConfigs.configs[appName] = formInputs;
            existingConfigs.latestAppName = appName;

            localStorage.setItem('ktlConfigurations', JSON.stringify(existingConfigs));

            const popupContainer = document.getElementById('popupContainer');

            const popupMessage = document.createElement('div');
            popupMessage.style.background = 'green';
            popupMessage.style.color = 'white';
            popupMessage.style.padding = '10px';
            popupMessage.style.marginBottom = '5px';
            popupMessage.style.borderRadius = '5px';
            popupMessage.innerText = `Configuration for "${appName}" has been saved successfully under "ktlConfigurations".`;

            popupContainer.appendChild(popupMessage);

            setTimeout(() => {
                popupContainer.removeChild(popupMessage);
            }, 2000);

        });

        document.getElementById('loadBtn').addEventListener('click', function () {
            const existingConfigs = JSON.parse(localStorage.getItem('ktlConfigurations')) || { configs: {} };
            const configListElement = document.getElementById('configList');
            configListElement.innerHTML = '';

            Object.keys(existingConfigs.configs).forEach(appName => {
                const li = document.createElement('li');
                li.classList.add('list-group-item');
                li.textContent = appName;
                li.style.cursor = 'pointer';
                li.onclick = () => loadConfiguration(appName);
                configListElement.appendChild(li);
            });

            $('#loadConfigModal').modal('show');
        });

        function loadConfiguration(appName) {
            const existingConfigs = JSON.parse(localStorage.getItem('ktlConfigurations')) || { configs: {} };
            if (existingConfigs.configs[appName]) {
                applyConfiguration(existingConfigs.configs[appName]);
                document.getElementById('appNameInput').value = appName;
                $('#loadConfigModal').modal('hide');
            } else {
                alert('Configuration not found.');
            }
        }

        document.getElementById('copyColor').addEventListener('click', function () {
            var color = document.getElementById('colorPicker').value;
            navigator.clipboard.writeText(color).then(function () {
                var confirmationMsg = document.createElement("div");
                confirmationMsg.textContent = 'Copied to clipboard: ' + color;
                confirmationMsg.style.position = "absolute";
                confirmationMsg.style.left = 0;
                confirmationMsg.style.bottom = "60px";
                confirmationMsg.style.backgroundColor = "#f0f0f0";
                confirmationMsg.style.padding = "5px";
                confirmationMsg.style.borderRadius = "5px";
                confirmationMsg.style.boxShadow = "0 2px 4px rgba(0,0,0,0.2)";
                confirmationMsg.style.fontSize = "0.8rem";
                confirmationMsg.style.zIndex = 1000;

                var container = document.getElementById('colorPickerContainer');
                container.appendChild(confirmationMsg);

                setTimeout(function () {
                    container.removeChild(confirmationMsg);
                }, 2000);
            }, function (err) {
                console.error('Could not copy color: ', err);
            });
        });

    </script>


    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>
